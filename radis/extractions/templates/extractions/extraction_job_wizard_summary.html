{% extends "extractions/extractions_layout.html" %}
{% load crispy from crispy_forms_tags %}
{% load bootstrap_icon from common_extras %}
{% block title %}
    New Extraction Job
{% endblock title %}
{% block heading %}
    <div class="d-flex justify-content-between align-items-start">
        <h4 class="mb-3 d-flex gap-3">
            <span>New Extraction Job - Summary</span>
            <button type="button"
                    class="btn btn-sm btn-info align-baseline"
                    hx-get="{% url 'extraction_help' %}"
                    hx-target="#htmx-dialog">
                Help
                {% bootstrap_icon "question-circle" %}
            </button>
        </h4>
        <a href="{% url 'extraction_job_list' %}">
            {% bootstrap_icon "list" %}
            Previous Jobs
        </a>
    </div>
{% endblock heading %}
{% block content %}
    <dl class="row">
        <dt class="col-sm-3">Job Title</dt>
        <dd class="col-sm-9">
            {{ search.title }}
        </dd>
        <dt class="col-sm-3">Search Query</dt>
        <dd class="col-sm-9">
            {{ search.query }}
        </dd>
        <dt class="col-sm-3">Language</dt>
        <dd class="col-sm-9">
            {{ search.language }}
        </dd>
        {% if search.modalities %}
            <dt class="col-sm-3">Modalities</dt>
            <dd class="col-sm-9">
                {{ search.modalities|join:", " }}
            </dd>
        {% endif %}
        {% if search.study_date_from %}
            <dt class="col-sm-3">Study Date From</dt>
            <dd class="col-sm-9">
                {{ search.study_date_from }}
            </dd>
        {% endif %}
        {% if search.study_date_till %}
            <dt class="col-sm-3">Study Date Till</dt>
            <dd class="col-sm-9">
                {{ search.study_date_till }}
            </dd>
        {% endif %}
        {% if search.study_description %}
            <dt class="col-sm-3">Study Description</dt>
            <dd class="col-sm-9">
                {{ search.study_description }}
            </dd>
        {% endif %}
        {% if search.patient_sex %}
            <dt class="col-sm-3">Patient Sex</dt>
            <dd class="col-sm-9">
                {{ search.get_patient_sex_display }}
            </dd>
        {% endif %}
        {% if search.age_from > 0 or search.age_till < 120 %}
            <dt class="col-sm-3">Age</dt>
            <dd class="col-sm-9">
                {{ search.age_from }} â€“ {{ search.age_till }}
            </dd>
        {% endif %}
        <dt class="mb-2">Filter Fields</dt>
        <dd class="mb-0">
            {% if filter_fields %}
                <ul class="mb-0">
                    {% for field in filter_fields %}
                        {% if field %}
                            <li>
                                <dl class="row mb-0">
                                    <dt class="col-sm-3">Name</dt>
                                    <dd class="col-sm-9">
                                        {{ field.name }}
                                    </dd>
                                    <dt class="col-sm-3">Description</dt>
                                    <dd class="col-sm-9">
                                        {{ field.description }}
                                    </dd>
                                </dl>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% endif %}
        </dd>
        <dt class="mb-2">Data Fields</dt>
        <dd class="mb-0">
            {% if data_fields %}
                <ul class="mb-0">
                    {% for field in data_fields %}
                        {% if field %}
                            <li>
                                <dl class="row mb-0">
                                    <dt class="col-sm-3">Name</dt>
                                    <dd class="col-sm-9">
                                        {{ field.name }}
                                    </dd>
                                    <dt class="col-sm-3">Description</dt>
                                    <dd class="col-sm-9">
                                        {{ field.description }}
                                    </dd>
                                    <dt class="col-sm-3">Data Type</dt>
                                    <dd class="col-sm-9">
                                        {{ field.get_data_type_display }}
                                    </dd>
                                </dl>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% endif %}
        </dd>
    </dl>
    <form action="" method="post" class="pt-3">
        {% csrf_token %}
        {{ wizard.management_form }}
        {% crispy form %}
        <div class="d-flex gap-2">
            <button type="submit"
                    name="wizard_goto_step"
                    value="{{ wizard.steps.prev }}"
                    class="btn btn-secondary">Previous Step (Data Fields)</button>
            <button type="submit" class="btn btn-primary">Create Extraction Job</button>
        </div>
    </form>
{% endblock content %}
